<!-- gestion/templates/gestion/sale_detail.html -->
{% extends 'gestion/base.html' %}
<!-- -->
{% block title %}Detalle de Venta #{{ sale.id }}{% endblock %}
<!-- -->
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Venta #{{ sale.id }}</h2>
  <a href="{% url 'sale_list' %}" class="btn btn-secondary">
    ← Volver al Listado
  </a>
</div> 

<div class="row">
  <!-- Información de la Venta -->
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">
        <h5>Información de la Venta</h5>
      </div>
      <div class="card-body">
        <p><strong>Fecha:</strong> {{ sale.sale_date|date:"d/m/Y H:i" }}</p>
        <p><strong>Cliente:</strong> {{ sale.client.name|default:"Cliente Varios" }}</p>
        {% if sale.client.rut %}
        <p><strong>RUT:</strong> {{ sale.client.rut }}</p>
        {% endif %}
        <p><strong>Vendedor:</strong> {{ sale.user.username }}</p>
        <p><strong>Total:</strong> ${{ sale.total_amount|floatformat:0 }}</p>
      </div>
    </div>
  </div>

  <!-- Items de la Venta -->
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5>Items Vendidos</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio Unit.</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody>
              {% for item in sale.items.all %}
              <tr>
                <td>{{ item.product.name|default:"Producto Eliminado" }}</td>
                <td>{{ item.quantity }}</td>
                <td>${{ item.price_at_sale|floatformat:0 }}</td>
                <td>${{ item.get_subtotal|floatformat:0 }}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="4" class="text-center text-muted">
                  No hay items registrados.
                </td>
              </tr>
              {% endfor %}
            </tbody>
            <tfoot>
              <tr>
                <th colspan="3">Total:</th>
                <th>${{ sale.total_amount|floatformat:0 }}</th>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

